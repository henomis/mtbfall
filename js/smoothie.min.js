(function(c){var d={extend:function(){arguments[0]=arguments[0]||{};for(var f=1;f<arguments.length;f++){for(var e in arguments[f]){if(arguments[f].hasOwnProperty(e)){if(typeof(arguments[f][e])==="object"){if(arguments[f][e] instanceof Array){arguments[0][e]=arguments[f][e]}else{arguments[0][e]=d.extend(arguments[0][e],arguments[f][e])}}else{arguments[0][e]=arguments[f][e]}}}}return arguments[0]}};function b(e){this.options=d.extend({},b.defaultOptions,e);this.data=[];this.maxValue=Number.NaN;this.minValue=Number.NaN}b.defaultOptions={resetBoundsInterval:3000,resetBounds:true};b.prototype.resetBounds=function(){if(this.data.length){this.maxValue=this.data[0][1];this.minValue=this.data[0][1];for(var e=1;e<this.data.length;e++){var f=this.data[e][1];if(f>this.maxValue){this.maxValue=f}if(f<this.minValue){this.minValue=f}}}else{this.maxValue=Number.NaN;this.minValue=Number.NaN}};b.prototype.append=function(h,g,f){var e=this.data.length-1;while(e>0&&this.data[e][0]>h){e--}if(this.data.length>0&&this.data[e][0]===h){if(f){this.data[e][1]+=g;g=this.data[e][1]}else{this.data[e][1]=g}}else{if(e<this.data.length-1){this.data.splice(e+1,0,[h,g])}else{this.data.push([h,g])}}this.maxValue=isNaN(this.maxValue)?g:Math.max(this.maxValue,g);this.minValue=isNaN(this.minValue)?g:Math.min(this.minValue,g)};b.prototype.dropOldData=function(e,f){var g=0;while(this.data.length-g>=f&&this.data[g+1][0]<e){g++}if(g!==0){this.data.splice(0,g)}};function a(e){this.options=d.extend({},a.defaultChartOptions,e);this.seriesSet=[];this.currentValueRange=1;this.currentVisMinValue=0;this.lastRenderTimeMillis=0}a.defaultChartOptions={millisPerPixel:20,enableDpiScaling:true,yMinFormatter:function(e,f){return parseFloat(e).toFixed(f)},yMaxFormatter:function(e,f){return parseFloat(e).toFixed(f)},maxValueScale:1,interpolation:"bezier",scaleSmoothing:0.125,maxDataSetLength:2,grid:{fillStyle:"#000000",strokeStyle:"#777777",lineWidth:1,sharpLines:false,millisPerLine:1000,verticalSections:2,borderVisible:true},labels:{fillStyle:"#ffffff",disabled:false,fontSize:10,fontFamily:"monospace",precision:2},horizontalLines:[]};a.AnimateCompatibility=(function(){var f=function(h,g){var i=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(j){return window.setTimeout(function(){j(new Date().getTime())},16)};return i.call(window,h,g)},e=function(h){var g=window.cancelAnimationFrame||function(i){clearTimeout(i)};return g.call(window,h)};return{requestAnimationFrame:f,cancelAnimationFrame:e}})();a.defaultSeriesPresentationOptions={lineWidth:1,strokeStyle:"#ffffff"};a.prototype.addTimeSeries=function(f,e){this.seriesSet.push({timeSeries:f,options:d.extend({},a.defaultSeriesPresentationOptions,e)});if(f.options.resetBounds&&f.options.resetBoundsInterval>0){f.resetBoundsTimerId=setInterval(function(){f.resetBounds()},f.options.resetBoundsInterval)}};a.prototype.removeTimeSeries=function(g){var f=this.seriesSet.length;for(var e=0;e<f;e++){if(this.seriesSet[e].timeSeries===g){this.seriesSet.splice(e,1);break}}if(g.resetBoundsTimerId){clearInterval(g.resetBoundsTimerId)}};a.prototype.getTimeSeriesOptions=function(g){var f=this.seriesSet.length;for(var e=0;e<f;e++){if(this.seriesSet[e].timeSeries===g){return this.seriesSet[e].options}}};a.prototype.bringToFront=function(g){var f=this.seriesSet.length;for(var e=0;e<f;e++){if(this.seriesSet[e].timeSeries===g){var h=this.seriesSet.splice(e,1);this.seriesSet.push(h[0]);break}}};a.prototype.streamTo=function(e,f){this.canvas=e;this.delay=f;this.start()};a.prototype.start=function(){if(this.frame){return}if(this.options.enableDpiScaling&&window&&window.devicePixelRatio!==1){var g=this.canvas.getAttribute("width");var e=this.canvas.getAttribute("height");this.canvas.setAttribute("width",g*window.devicePixelRatio);this.canvas.setAttribute("height",e*window.devicePixelRatio);this.canvas.style.width=g+"px";this.canvas.style.height=e+"px";this.canvas.getContext("2d").scale(window.devicePixelRatio,window.devicePixelRatio)}var f=function(){this.frame=a.AnimateCompatibility.requestAnimationFrame(function(){this.render();f()}.bind(this))}.bind(this);f()};a.prototype.stop=function(){if(this.frame){a.AnimateCompatibility.cancelAnimationFrame(this.frame);delete this.frame}};a.prototype.updateValueRange=function(){var h=this.options,f=Number.NaN,l=Number.NaN;for(var j=0;j<this.seriesSet.length;j++){var m=this.seriesSet[j].timeSeries;if(!isNaN(m.maxValue)){f=!isNaN(f)?Math.max(f,m.maxValue):m.maxValue}if(!isNaN(m.minValue)){l=!isNaN(l)?Math.min(l,m.minValue):m.minValue}}if(h.maxValue!=null){f=h.maxValue}else{f*=h.maxValueScale}if(h.minValue!=null){l=h.minValue}if(this.options.yRangeFunction){var i=this.options.yRangeFunction({min:l,max:f});l=i.min;f=i.max}if(!isNaN(f)&&!isNaN(l)){var e=f-l;var g=(e-this.currentValueRange);var k=(l-this.currentVisMinValue);this.isAnimatingScale=Math.abs(g)>0.1||Math.abs(k)>0.1;this.currentValueRange+=h.scaleSmoothing*g;this.currentVisMinValue+=h.scaleSmoothing*k}this.valueRange={min:l,max:f}};a.prototype.render=function(q,p){var k=new Date().getTime();if(!this.isAnimatingScale){var D=Math.min(1000/6,this.options.millisPerPixel);if(k-this.lastRenderTimeMillis<D){return}}this.lastRenderTimeMillis=k;q=q||this.canvas;p=p||k-(this.delay||0);p-=p%this.options.millisPerPixel;var h=q.getContext("2d"),I=this.options,n={top:0,left:0,width:q.clientWidth,height:q.clientHeight},F=p-(n.width*I.millisPerPixel),s=function(i){var t=i-this.currentVisMinValue;return this.currentValueRange===0?n.height:n.height-(Math.round((t/this.currentValueRange)*n.height))}.bind(this),L=function(i){return Math.round(n.width-((p-i)/I.millisPerPixel))};this.updateValueRange();h.font=I.labels.fontSize+"px "+I.labels.fontFamily;h.save();h.translate(n.left,n.top);h.beginPath();h.rect(0,0,n.width,n.height);h.clip();h.save();h.fillStyle=I.grid.fillStyle;h.clearRect(0,0,n.width,n.height);h.fillRect(0,0,n.width,n.height);h.restore();h.save();h.lineWidth=I.grid.lineWidth;h.strokeStyle=I.grid.strokeStyle;if(I.grid.millisPerLine>0){var N=n.width-h.measureText(M).width+4;for(var C=p-(p%I.grid.millisPerLine);C>=F;C-=I.grid.millisPerLine){var B=L(C);if(I.grid.sharpLines){B-=0.5}h.beginPath();h.moveTo(B,0);h.lineTo(B,n.height);h.stroke();h.closePath();if(I.timestampFormatter&&B<N){var O=new Date(C),e=I.timestampFormatter(O),P=h.measureText(e).width;N=B-P-2;h.fillStyle=I.labels.fillStyle;h.fillText(e,B-P,n.height-2)}}}for(var A=1;A<I.grid.verticalSections;A++){var z=Math.round(A*n.height/I.grid.verticalSections);if(I.grid.sharpLines){z-=0.5}h.beginPath();h.moveTo(0,z);h.lineTo(n.width,z);h.stroke();h.closePath()}if(I.grid.borderVisible){h.beginPath();h.strokeRect(0,0,n.width,n.height);h.closePath()}h.restore();if(I.horizontalLines&&I.horizontalLines.length){for(var g=0;g<I.horizontalLines.length;g++){var w=I.horizontalLines[g],E=Math.round(s(w.value))-0.5;h.strokeStyle=w.color||"#ffffff";h.lineWidth=w.lineWidth||1;h.beginPath();h.moveTo(0,E);h.lineTo(n.width,E);h.stroke();h.closePath()}}for(var K=0;K<this.seriesSet.length;K++){h.save();var H=this.seriesSet[K].timeSeries,G=H.data,l=this.seriesSet[K].options;H.dropOldData(F,I.maxDataSetLength);h.lineWidth=l.lineWidth;h.strokeStyle=l.strokeStyle;h.beginPath();var f=0,o=0,m=0;for(var J=0;J<G.length&&G.length!==1;J++){var u=L(G[J][0]),r=s(G[J][1]);if(J===0){f=u;h.moveTo(u,r)}else{switch(I.interpolation){case"linear":case"line":h.lineTo(u,r);break;case"bezier":default:h.bezierCurveTo(Math.round((o+u)/2),m,Math.round((o+u))/2,r,u,r);break;case"step":h.lineTo(u,m);h.lineTo(u,r);break}}o=u;m=r}if(G.length>1){if(l.fillStyle){h.lineTo(n.width+l.lineWidth+1,m);h.lineTo(n.width+l.lineWidth+1,n.height+l.lineWidth+1);h.lineTo(f,n.height+l.lineWidth);h.fillStyle=l.fillStyle;h.fill()}if(l.strokeStyle&&l.strokeStyle!=="none"){h.stroke()}h.closePath()}h.restore()}if(!I.labels.disabled&&!isNaN(this.valueRange.min)&&!isNaN(this.valueRange.max)){var j=I.yMaxFormatter(this.valueRange.max,I.labels.precision),M=I.yMinFormatter(this.valueRange.min,I.labels.precision);h.fillStyle=I.labels.fillStyle;h.fillText(j,n.width-h.measureText(j).width-2,I.labels.fontSize);h.fillText(M,n.width-h.measureText(M).width-2,n.height-2)}h.restore()};a.timeFormatter=function(e){function f(g){return(g<10?"0":"")+g}return f(e.getHours())+":"+f(e.getMinutes())+":"+f(e.getSeconds())};c.TimeSeries=b;c.SmoothieChart=a})(typeof exports==="undefined"?this:exports);